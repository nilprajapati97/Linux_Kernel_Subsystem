Let's walk **end-to-end** through creating a **minimal Linux kernel module (`.ko` file)** and demonstrate:

> âœ… Writing code
> âœ… Compiling with `Makefile`
> âœ… Loading with `insmod`
> âœ… Inspecting with `dmesg`, `/sys/module`, and `readelf`

---

## âœ… Step 1: Write the Kernel Module Code

ğŸ“ **Directory structure:**

```
my_module/
â”œâ”€â”€ Makefile
â””â”€â”€ hello.c
```

ğŸ“„ `hello.c`

```c
#include <linux/module.h>
#include <linux/kernel.h>

static int __init hello_init(void)
{
    pr_info("âœ… Hello kernel module loaded!\n");
    return 0;
}

static void __exit hello_exit(void)
{
    pr_info("ğŸ§¹ Hello kernel module unloaded.\n");
}

module_init(hello_init);
module_exit(hello_exit);

MODULE_LICENSE("GPL");
MODULE_AUTHOR("You");
MODULE_DESCRIPTION("A minimal example module");
```

---

## âœ… Step 2: Write the `Makefile`

ğŸ“„ `Makefile`

```make
obj-m += hello.o

all:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

clean:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean
```

---

## âœ… Step 3: Build the Module

```bash
$ make
```

This generates:

```
hello.ko        â† kernel module
hello.o         â† object file
```

---

## âœ… Step 4: Insert into Kernel

```bash
$ sudo insmod hello.ko
```

âœ… **Check Logs:**

```bash
$ dmesg | tail
```

You should see:

```
[ 1234.567 ] âœ… Hello kernel module loaded!
```

---

## âœ… Step 5: Inspect the Loaded Module

### ğŸ” View in `/sys/module/`

```bash
$ ls /sys/module/hello/
sections/  initstate  refcnt  ...
```

### ğŸ” Show Section Addresses:

```bash
$ cat /sys/module/hello/sections/.text
0xffffffffc02a0000
```

### ğŸ” Check with `lsmod`:

```bash
$ lsmod | grep hello
hello       16384  0
```

---

## âœ… Step 6: Remove the Module

```bash
$ sudo rmmod hello
$ dmesg | tail
```

Youâ€™ll see:

```
ğŸ§¹ Hello kernel module unloaded.
```

---

## âœ… Step 7: Inspect with `readelf` and `objdump`

```bash
$ readelf -S hello.ko
$ objdump -h hello.ko
```

Look for:

* `.text`: contains `hello_init` and `hello_exit`
* `.modinfo`: contains metadata like license/author
* `.rela.text`: for relocations

---

## âœ… Step 8: Check Symbols (Optional)

```bash
$ nm hello.ko
```

---

## ğŸ§  Summary

| Task           | Command                    |        |
| -------------- | -------------------------- | ------ |
| Build          | `make`                     |        |
| Load           | `sudo insmod hello.ko`     |        |
| View logs      | \`dmesg                    | tail\` |
| Inspect module | `/sys/module/hello/`       |        |
| Unload         | `sudo rmmod hello`         |        |
| ELF inspection | `readelf`, `objdump`, `nm` |        |

---

Would you like to:

* ğŸ”§ Add parameters to the module?
* ğŸ“¦ Add device file support?
* ğŸ§ª Auto-load from `udev` or modprobe?

Let me know â€” I can extend this with GPIO or I2C sensor integration too.
