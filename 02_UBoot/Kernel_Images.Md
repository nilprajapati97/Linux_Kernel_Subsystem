Here’s a deep-level explanation of uImage, boot.img, vmlinux, and vmlinuz — what they are, how they’re generated, and where they're used — tailored for a 10-year experienced Linux/Embedded developer.

🔍 Overview Table
=============================================================================================
| Format     | Description                                        | Bootloader Use | Compression | Used In                |
| ---------- | -------------------------------------------------- | -------------- | ----------- | ---------------------- |
| `vmlinux`  | Raw, uncompressed ELF kernel binary                | ❌              | ❌           | Debugging, symbol info |
| `vmlinuz`  | Compressed kernel image (gzip/xz)                  | ❌              | ✅           | Grub/PC boot           |
| `zImage`   | Compressed ARM kernel with small decompressor stub | ✅ (bootz)      | ✅           | ARM Linux              |
| `uImage`   | `zImage` + U-Boot header (`mkimage`)               | ✅ (bootm)      | ✅           | U-Boot                 |
| `boot.img` | Android-style boot image (kernel + dtb + ramdisk)  | ✅ (fastboot)   | ✅           | Android devices        |


🧠 1. vmlinux
-------------------------------------------------------------
The uncompressed ELF kernel produced by the build system.
Contains symbols, sections, and debugging info.
Not bootable by itself.

📁 Location:
            ~/linux/arch/arm/boot/vmlinux

🎯 Use:
        Kernel debugging with gdb, objdump, nm, etc.



🧠 2. vmlinuz
---------------------------------------------------------------------------------
01. Compressed version of vmlinux using gzip or xz.
02. Used by GRUB or legacy x86 bootloaders.
03. Supports decompression before handing control to the kernel.

📁 Location:
            /boot/vmlinuz-<version>
📦 Generated by:
                make bzImage     # x86/x86_64


🧠 3. zImage
---------------------------------------------------------------------------------
01. Compressed kernel image with embedded decompression stub.
02. Used by ARM and other embedded architectures.
03. Decompression message: Uncompressing Linux... done...

📁 Output:
            arch/arm/boot/zImage
🛠️ Generate:
            make zImage


🧠 4. uImage
---------------------------------------------------------------------------------
01. U-Boot-specific image format.
02. zImage wrapped with a U-Boot header using mkimage.
03. Required by bootm command in U-Boot.

📁 Output:
          arch/arm/boot/uImage
🛠️ Generate:
            make uImage
Requires:
            export CROSS_COMPILE=arm-linux-gnueabihf-
            export ARCH=arm
            make uImage LOADADDR=0x80008000

🔧 mkimage tool is provided by U-Boot (u-boot-tools package):
            mkimage -A arm -O linux -T kernel -C gzip -a 0x80008000 -e 0x80008000 -n "Linux Kernel" -d zImage uImage



🧠 5. boot.img (Android)
---------------------------------------------------------------------------------
Android boot image format: wraps kernel + ramdisk + optional DTB.

Used in fastboot and A/B partitions.

📁 Structure:
                +-----------+------------+----------+
                |  Kernel   |  Ramdisk   |  DTB     |
                +-----------+------------+----------+

🛠️ Generate using mkbootimg:
                            mkbootimg --kernel zImage \
                                      --ramdisk ramdisk.img \
                                      --output boot.img \
                                      --base 0x80000000 \
                                      --cmdline "console=ttyS0,115200"

📦 Tool: mkbootimg from Android source or android-tools.


📌 Summary of How to Generate
===================================================================================================================
| Format     | Command                                               |
| ---------- | ----------------------------------------------------- |
| `vmlinux`  | `make` or `make zImage` or `make uImage`              |
| `vmlinuz`  | `make bzImage` (x86 only)                             |
| `zImage`   | `make zImage`                                         |
| `uImage`   | `make uImage` or `mkimage -d zImage uImage`           |
| `boot.img` | `mkbootimg --kernel zImage --ramdisk ramdisk.img ...` |


🔎 Interview Tips
✅ Q: Why do we need uImage if zImage already exists?

Because U-Boot bootm requires the image to have a U-Boot header (added via mkimage).

✅ Q: What’s the difference between zImage and uImage?

Both contain the compressed kernel; uImage is zImage + U-Boot header.

✅ Q: What’s inside a boot.img?

Kernel + initramfs + optional DTB, used in Android bootloaders (fastboot).

✅ Q: When do you use bootz vs bootm in U-Boot?

bootz → raw zImage

bootm → uImage with header



🧭 Linux Kernel Image Relationship Diagram
===================================================================================================================
                +------------------+
                |   vmlinux        |   <-- Full ELF binary (symbols, debug)
                |------------------|
                | .text .data .bss |
                | .symtab, etc.    |
                +------------------+
                         |
                         | gzip/xz compression
                         v
                +------------------+
                |   vmlinuz        |   <-- Compressed ELF (for GRUB/x86)
                +------------------+

       (ARM flow)
                         |
                         v
              +-------------------+
              |    zImage         |   <-- Compressed kernel (gzip) + decompressor stub
              |-------------------|
              | Decompressor code |
              | Compressed vmlinux|
              +-------------------+
                         |
          +--------------+----------------+
          |                               |
          v                               v
 +------------------+           +------------------+
 |     uImage       |           |    boot.img (Android) |
 |------------------|           |----------------------|
 | U-Boot header     |           | Kernel (zImage)      |
 | zImage inside     |           | Ramdisk              |
 +------------------+           | Optional DTB         |
                                +----------------------+



💡 Bootloader Compatibility
===================================================================================================================

| Image      | Used by          | Format          | Boot Command    |
| ---------- | ---------------- | --------------- | --------------- |
| `vmlinux`  | Not bootable     | ELF             | N/A             |
| `vmlinuz`  | GRUB (x86)       | Gzip-compressed | Grub config     |
| `zImage`   | U-Boot (bootz)   | Custom ARM      | `bootz`         |
| `uImage`   | U-Boot (bootm)   | U-Boot format   | `bootm`         |
| `boot.img` | Android fastboot | AOSP boot.img   | `fastboot boot` |


🔧 How they’re built
==================================================================================================================
| Image    | Built By              | Command                         |
| -------- | --------------------- | ------------------------------- |
| vmlinux  | Kernel build          | `make`                          |
| vmlinuz  | Kernel build (x86)    | `make bzImage`                  |
| zImage   | Kernel build (ARM)    | `make zImage`                   |
| uImage   | `mkimage` + zImage    | `make uImage` or `mkimage ...`  |
| boot.img | AOSP `mkbootimg` tool | `mkbootimg --kernel zImage ...` |


